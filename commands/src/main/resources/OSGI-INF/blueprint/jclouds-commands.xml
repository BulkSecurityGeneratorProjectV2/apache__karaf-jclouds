<!--

    Copyright (C) 2010 Progress Software, Inc. All rights reserved.
    http://fusesource.com

    The software in this package is published under the terms of the AGPL license
    a copy of which has been included with this distribution in the license.txt file.

-->
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">


    <command-bundle xmlns="http://karaf.apache.org/xmlns/shell/v1.0.0">
        <command name="jclouds/node-create">
            <action class="org.jclouds.karaf.commands.compute.NodeCreateCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
            <completers>
                <ref component-id="imageCompleter"/>
                <ref component-id="locationCompleter"/>
                <null/>
            </completers>
        </command>
        <command name="jclouds/node-destroy">
            <action class="org.jclouds.karaf.commands.compute.NodeDestroyCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
            <completers>
                <ref component-id="activeNodeCompleter"/>
            </completers>
        </command>
        <command name="jclouds/node-destroy-all">
            <action class="org.jclouds.karaf.commands.compute.NodeDestroyAllCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
        </command>
        <command name="jclouds/group-destroy">
            <action class="org.jclouds.karaf.commands.compute.GroupDestroyCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
            <completers>
                <ref component-id="groupCompleter"/>
            </completers>
        </command>
        <command name="jclouds/node-suspend">
            <action class="org.jclouds.karaf.commands.compute.NodeSuspendCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
            <completers>
                <ref component-id="activeNodeCompleter"/>
            </completers>
        </command>
        <command name="jclouds/node-resume">
            <action class="org.jclouds.karaf.commands.compute.NodeResumeCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
            <completers>
                <ref component-id="suspendedNodeCompleter"/>
            </completers>
        </command>
        <command name="jclouds/node-runscript">
            <action class="org.jclouds.karaf.commands.compute.NodeRunScriptCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
            <completers>
                <ref component-id="activeNodeCompleter"/>
            </completers>
        </command>
        <command name="jclouds/group-runscript">
            <action class="org.jclouds.karaf.commands.compute.GroupRunScriptCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
            <completers>
                <ref component-id="groupCompleter"/>
            </completers>
        </command>
        <command name="jclouds/provider-info">
            <action class="org.jclouds.karaf.commands.compute.ProviderInfoCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
        </command>
        <command name="jclouds/compute-provider-list">
            <action class="org.jclouds.karaf.commands.compute.ComputeListCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
        </command>
        <command name="jclouds/blobstore-provider-list">
            <action class="org.jclouds.karaf.commands.blobstore.BlobStoreListCommand">
                <property name="blobStoreServices" ref="blobStoreServices"/>
            </action>
        </command>
        <command name="jclouds/node-list">
            <action class="org.jclouds.karaf.commands.compute.NodeListCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
        </command>
        <command name="jclouds/hardware-list">
            <action class="org.jclouds.karaf.commands.compute.HardwareListCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
        </command>
        <command name="jclouds/location-list">
            <action class="org.jclouds.karaf.commands.compute.LocationListCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
        </command>
        <command name="jclouds/image-list">
            <action class="org.jclouds.karaf.commands.compute.ImageListCommand">
                <property name="computeServices" ref="computeServices"/>
            </action>
        </command>
        <command name="jclouds/blobstore-write">
            <action class="org.jclouds.karaf.commands.blobstore.BlobWriteCommand">
                <property name="blobStoreServices" ref="blobStoreServices"/>
            </action>
            <completers>
                <ref component-id="containerCompleter"/>
                <ref component-id="blobCompleter"/>
                <null/>
            </completers>
        </command>

        <command name="jclouds/blobstore-read">
            <action class="org.jclouds.karaf.commands.blobstore.BlobReadCommand">
                <property name="blobStoreServices" ref="blobStoreServices"/>
            </action>
            <completers>
                <ref component-id="containerCompleter"/>
                <ref component-id="blobCompleter"/>
                <null/>
            </completers>
        </command>
        <command name="jclouds/blobstore-list">
            <action class="org.jclouds.karaf.commands.blobstore.BlobListCommand">
                <property name="blobStoreServices" ref="blobStoreServices"/>
            </action>
        </command>
        <command name="jclouds/blobstore-create">
            <action class="org.jclouds.karaf.commands.blobstore.BlobCreateCommand">
                <property name="blobStoreServices" ref="blobStoreServices"/>
            </action>
        </command>
        <command name="jclouds/blobstore-delete">
            <action class="org.jclouds.karaf.commands.blobstore.BlobDeleteCommand">
                <property name="blobStoreServices" ref="blobStoreServices"/>
            </action>
            <completers>
                <ref component-id="containerCompleter"/>
            </completers>
        </command>
    </command-bundle>

    <reference-list id="computeServices" interface="org.jclouds.compute.ComputeService" availability="optional">
        <reference-listener ref="computeCacheManager" bind-method="bind" unbind-method="unbind"/>
    </reference-list>

    <reference-list id="blobStoreServices" interface="org.jclouds.blobstore.BlobStore" availability="optional">
        <reference-listener ref="blobCacheManager" bind-method="bind" unbind-method="unbind"/>
    </reference-list>

    <!-- Blob Completers -->
    <bean id="containerCompleter" class="org.jclouds.karaf.commands.blobstore.completer.ContainerCompleter">
        <property name="blobStoreServices" ref="blobStoreServices"/>
    </bean>

    <bean id="blobCompleter" class="org.jclouds.karaf.commands.blobstore.completer.BlobCompleter">
        <property name="blobStoreServices" ref="blobStoreServices"/>
    </bean>

    <!-- Compute Completers -->
    <bean id="activeNodeCompleter" class="org.jclouds.karaf.commands.compute.completer.ActiveNodesCompleter">
        <property name="computeServices" ref="computeServices"/>
    </bean>

    <bean id="inActiveNodeCompleter" class="org.jclouds.karaf.commands.compute.completer.InactiveNodesCompleter">
        <property name="computeServices" ref="computeServices"/>
    </bean>

    <bean id="groupCompleter" class="org.jclouds.karaf.commands.compute.completer.GroupCompleter">
        <property name="computeServices" ref="computeServices"/>
    </bean>

    <bean id="suspendedNodeCompleter" class="org.jclouds.karaf.commands.compute.completer.SuspendedNodesCompleter">
        <property name="computeServices" ref="computeServices"/>
    </bean>

    <bean id="imageCompleter" class="org.jclouds.karaf.commands.compute.completer.ImageCompleter">
        <property name="computeServices" ref="computeServices"/>
    </bean>

    <bean id="locationCompleter" class="org.jclouds.karaf.commands.compute.completer.LocationCompleter">
        <property name="computeServices" ref="computeServices"/>
    </bean>

    <!-- Cache Managers -->
    <bean id="computeCacheManager" class="org.jclouds.karaf.commands.cache.ComputeCacheManager" init-method="init" destroy-method="destroy">
        <property name="cacheables">
            <list>
                <ref component-id="activeNodeCompleter"/>
                <ref component-id="inActiveNodeCompleter"/>
                <ref component-id="suspendedNodeCompleter"/>
                <ref component-id="imageCompleter"/>
                <ref component-id="groupCompleter"/>
                <ref component-id="locationCompleter"/>
            </list>
        </property>
    </bean>

    <bean id="blobCacheManager" class="org.jclouds.karaf.commands.cache.BlobCacheManager" init-method="init" destroy-method="destroy">
        <property name="cacheables">
            <list>
                <ref component-id="blobCompleter"/>
                <ref component-id="containerCompleter"/>
            </list>
        </property>
    </bean>

</blueprint>